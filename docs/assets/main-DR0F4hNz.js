var $=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function M(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}function k(c){if(Object.prototype.hasOwnProperty.call(c,"__esModule"))return c;var E=c.default;if(typeof E=="function"){var y=function v(){var g=!1;try{g=this instanceof v}catch{}return g?Reflect.construct(E,arguments,this.constructor):E.apply(this,arguments)};y.prototype=E.prototype}else y={};return Object.defineProperty(y,"__esModule",{value:!0}),Object.keys(c).forEach(function(v){var g=Object.getOwnPropertyDescriptor(c,v);Object.defineProperty(y,v,g.get?g:{enumerable:!0,get:function(){return c[v]}})}),y}var x={},A;function R(){return A||(A=1,(function(c){(function(E){E([],function(){var y=-1,v=-2,g=-3,P=-4,T=-5,C=function(t,n){n=n||{};var o=n.verbose||!1;o&&console.log("Normalize the JSON Object"),t=typeof t=="string"?this.JSON.parse(t):t,o&&console.log("Creating a empty dictionary");var e={strings:[],integers:[],floats:[]};o&&console.log("Creating the AST");var a=(function p(r){o&&console.log("Calling recursiveAstBuilder with "+this.JSON.stringify(r));var i=typeof r;if(r===null)return{type:"null",index:g};if(typeof r>"u")return{type:"undefined",index:T};if(r instanceof Array){var h=["@"];for(var u in r)r.hasOwnProperty(u)&&h.push(p(r[u]));return h}if(i==="object"){var h=["$"];for(var w in r)r.hasOwnProperty(w)&&(h.push(p(w)),h.push(p(r[w])));return h}if(r==="")return{type:"empty",index:P};if(i==="string"){var l=j.call(e.strings,r);return l==-1&&(e.strings.push(J(r)),l=e.strings.length-1),{type:"strings",index:l}}if(i==="number"&&r%1===0){var l=j.call(e.integers,r);return l==-1&&(e.integers.push(_(r)),l=e.integers.length-1),{type:"integers",index:l}}if(i==="number"){var l=j.call(e.floats,r);return l==-1&&(e.floats.push(r),l=e.floats.length-1),{type:"floats",index:l}}if(i==="boolean")return{type:"boolean",index:r?y:v};throw new Error("Unexpected argument of type "+typeof r)})(t),f=e.strings.length,N=e.integers.length;e.floats.length,o&&console.log("Parsing the dictionary");var O=e.strings.join("|");return O+="^"+e.integers.join("|"),O+="^"+e.floats.join("|"),o&&console.log("Parsing the structure"),O+="^"+(function p(r){if(o&&console.log("Calling a recursiveParser with "+this.JSON.stringify(r)),r instanceof Array){var i=r.shift();for(var h in r)r.hasOwnProperty(h)&&(i+=p(r[h])+"|");return(i[i.length-1]==="|"?i.slice(0,-1):i)+"]"}var u=r.type,w=r.index;if(u==="strings")return _(w);if(u==="integers")return _(f+w);if(u==="floats")return _(f+N+w);if(u==="boolean")return r.index;if(u==="null")return g;if(u==="undefined")return T;if(u==="empty")return P;throw new TypeError("The item is alien!")})(a),o&&console.log("Ending parser"),n.debug?{dictionary:e,ast:a,packed:O}:O},B=function(t,n){n=n||{};var o=t.split("^");n.verbose&&console.log("Building dictionary");var e=[],a=o[0];if(a!==""){a=a.split("|"),n.verbose&&console.log("Parse the strings dictionary");for(var f=0,N=a.length;f<N;f++)e.push(L(a[f]))}if(a=o[1],a!==""){a=a.split("|"),n.verbose&&console.log("Parse the integers dictionary");for(var f=0,N=a.length;f<N;f++)e.push(S(a[f]))}if(a=o[2],a!==""){a=a.split("|"),n.verbose&&console.log("Parse the floats dictionary");for(var f=0,N=a.length;f<N;f++)e.push(parseFloat(a[f]))}a=null,n.verbose&&console.log("Tokenizing the structure");for(var O="",p=[],r=o[3].length,f=0;f<r;f++){var i=o[3].charAt(f);i==="|"||i==="$"||i==="@"||i==="]"?(O&&(p.push(S(O)),O=""),i!=="|"&&p.push(i)):O+=i}var h=p.length,u=0;return n.verbose&&console.log("Starting recursive parser"),(function w(){var l=p[u++];if(n.verbose&&console.log("Reading collection type "+(l==="$"?"object":"Array")),l==="@"){for(var s=[];u<h;u++){var b=p[u];if(n.verbose&&console.log("Read "+b+" symbol"),b==="]")return s;if(b==="@"||b==="$")s.push(w());else switch(b){case y:s.push(!0);break;case v:s.push(!1);break;case g:s.push(null);break;case T:s.push(void 0);break;case P:s.push("");break;default:s.push(e[b])}}return n.verbose&&console.log("Parsed "+this.JSON.stringify(s)),s}if(l==="$"){for(var s={};u<h;u++){var d=p[u];if(d==="]")return s;d===P?d="":d=e[d];var b=p[++u];if(b==="@"||b==="$")s[d]=w();else switch(b){case y:s[d]=!0;break;case v:s[d]=!1;break;case g:s[d]=null;break;case T:s[d]=void 0;break;case P:s[d]="";break;default:s[d]=e[b]}}return n.verbose&&console.log("Parsed "+this.JSON.stringify(s)),s}throw new TypeError("Bad token "+l+" isn't a type")})()},J=function(t){return typeof t!="string"?t:t.replace(/[\+ \|\^\%]/g,function(n){return{" ":"+","+":"%2B","|":"%7C","^":"%5E","%":"%25"}[n]})},L=function(t){return typeof t!="string"?t:t.replace(/\+|%2B|%7C|%5E|%25/g,function(n){return{"+":" ","%2B":"+","%7C":"|","%5E":"^","%25":"%"}[n]})},_=function(t){return Number.prototype.toString.call(t,36).toUpperCase()},S=function(t){return parseInt(t,36)},j=Array.prototype.indexOf||function(t,n){for(var o=n||0,e=this.length;o<e;o++)if(this[o]===t)return o;return-1};return{JSON,pack:C,unpack:B}})})(function(E,y){var v=y();for(var g in v)c[g]=v[g]})})(x)),x}var U=R();const I=M(U);export{k as a,$ as c,M as g,I as j};
